{%- liquid
  assign menu = linklists[section.settings.menu]
  if menu and menu.links.size > 0
    assign has_menu = true
  else
    assign has_menu = false
  endif

  assign show_account = shop.customer_accounts_enabled
  if section.settings.sticky_header_type != 'none'
    assign sticky_enabled = true
  else
    assign sticky_enabled = false
  endif
-%}

<section
  class="relative z-30 color-{{ section.settings.color_scheme }} gradient"
  style="background: rgb(var(--color-background)); color: rgb(var(--color-foreground)); margin-bottom: {{ section.settings.margin_bottom }}px;"
>
  <div
    x-data="
      {
        mobileOpen: false,
        toggleMobile() { this.mobileOpen = !this.mobileOpen },
        closeMobile() { this.mobileOpen = false }
      }
    "
    @keydown.window.escape="closeMobile()"
    class="{% if sticky_enabled %}sticky top-0{% endif %}"
    style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  >
    <div class="w-full max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-10">
      <div class="flex items-center h-16 gap-4 border-current/15 {% if section.settings.show_line_separator %}border-b{% endif %}">
        <div class="flex items-center gap-3 min-w-30">
          <button
            type="button"
            class="lg:hidden inline-flex items-center justify-center w-10 h-10 rounded-md border border-current/15 hover:bg-current/5 transition"
            @click="toggleMobile()"
            aria-label="Open menu"
          >
            <span class="sr-only">Toggle navigation</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
            </svg>
          </button>

          <a href="{{ routes.root_url }}" class="flex items-center gap-2 focus:outline-none">
            {%- if settings.logo != blank -%}
              {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
              {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
              {%- assign logo_height_class = section.settings.logo_icons_size | replace: 'size-', 'h-' -%}
              {%- assign logo_size_class = logo_height_class | append: ' w-auto object-contain' -%}
              {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 40vw, {{ settings.logo_width }}px{% endcapture %}
              {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
              {{
                settings.logo
                | image_url: width: 600
                | image_tag:
                  class: logo_size_class,
                  widths: widths,
                  height: logo_height,
                  width: settings.logo_width,
                  alt: logo_alt,
                  sizes: sizes,
                  preload: true
              }}
            {%- else -%}
              <span class="text-lg font-semibold tracking-tight">{{ shop.name }}</span>
            {%- endif -%}
          </a>
        </div>

        {%- if has_menu -%}
          <nav class="hidden lg:flex flex-1 items-center justify-center gap-6 text-sm font-medium">
            {%- for link in menu.links -%}
              {%- if link.links.size > 0 -%}
                {%- assign has_children = true -%}
              {%- else -%}
                {%- assign has_children = false -%}
              {%- endif -%}
              <div class="relative group">
                <a
                  href="{{ link.url }}"
                  class="flex items-center gap-1 px-2 py-1 rounded-md hover:bg-current/5 transition"
                >
                  {{ link.title }}
                  {%- if has_children -%}
                    <span class="text-[10px] opacity-60">â–¼</span>
                  {%- endif -%}
                </a>
                {%- if has_children -%}
                  <div class="absolute left-0 top-full mt-2 min-w-55 rounded-md border border-current/10 bg-[rgb(var(--color-background))] text-[rgb(var(--color-foreground))] shadow-lg opacity-0 invisible translate-y-1 group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 transition">
                    <div class="flex flex-col py-2">
                      {%- for child in link.links -%}
                        <a href="{{ child.url }}" class="px-4 py-2 text-sm hover:bg-current/5 transition">
                          {{- child.title -}}
                        </a>
                      {%- endfor -%}
                    </div>
                  </div>
                {%- endif -%}
              </div>
            {%- endfor -%}
          </nav>
        {%- else -%}
          <div class="flex-1" aria-hidden="true"></div>
        {%- endif -%}

        <div class="flex items-center justify-end gap-3 min-w-40">
          <a
            href="{{ routes.search_url }}"
            class="inline-flex items-center justify-center w-10 h-10 rounded-md border border-current/15 hover:bg-current/5 transition"
            aria-label="Search"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M11 18a7 7 0 100-14 7 7 0 000 14z" />
            </svg>
          </a>

          {%- if show_account -%}
            <a
              href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
              class="inline-flex items-center justify-center w-10 h-10 rounded-md border border-current/15 hover:bg-current/5 transition"
              aria-label="Account"
              rel="nofollow"
            >
              {%- if section.settings.enable_customer_avatar and customer and customer.has_avatar? -%}
                <span class="inline-flex w-7 h-7 overflow-hidden rounded-full">{{ customer | avatar }}</span>
              {%- else -%}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a5 5 0 100-10 5 5 0 000 10zM4 20.5c0-3.59 3.13-6.5 7-6.5s7 2.91 7 6.5" />
                </svg>
              {%- endif -%}
            </a>
          {%- endif -%}

          <a
            href="{{ routes.cart_url }}"
            class="inline-flex items-center justify-center w-10 h-10 rounded-md border border-current/15 hover:bg-current/5 transition relative"
            aria-label="Cart"
            id="cart-icon-bubble"
          >
            {%- if cart == empty -%}
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h2l1 14h12l1-10H6" />
                <circle cx="9" cy="20" r="1.25" />
                <circle cx="17" cy="20" r="1.25" />
              </svg>
            {%- else -%}
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h2l1 14h12l1-10H6z" />
                <circle cx="9" cy="20" r="1.25" />
                <circle cx="17" cy="20" r="1.25" />
              </svg>
            {%- endif -%}
            {%- if cart != empty -%}
              <span class="absolute -top-1 -right-1 min-w-4.5 h-4.5 rounded-full bg-current text-[rgb(var(--color-background))] text-[10px] font-semibold flex items-center justify-center px-1">
                {%- if cart.item_count < 100 -%}
                  {{ cart.item_count }}
                {%- else -%}
                  99+
                {%- endif -%}
              </span>
            {%- endif -%}
          </a>

          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when '@app' -%}
                {% render block %}
            {%- endcase -%}
          {%- endfor -%}
        </div>
      </div>
    </div>

    {%- if has_menu -%}
      <div
        x-cloak
        x-show="mobileOpen"
        class="fixed inset-0 z-40 lg:hidden"
        aria-modal="true"
        role="dialog"
      >
        <div class="absolute inset-0 bg-black/40" @click="closeMobile()"></div>
        <div
          class="relative ml-auto h-full w-full max-w-sm bg-[rgb(var(--color-background))] text-[rgb(var(--color-foreground))] shadow-2xl flex flex-col"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="translate-x-full opacity-0"
          x-transition:enter-end="translate-x-0 opacity-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="translate-x-0 opacity-100"
          x-transition:leave-end="translate-x-full opacity-0"
        >
          <div class="flex items-center justify-between px-4 py-3 border-b border-current/10">
            <span class="text-sm font-semibold">Menu</span>
            <button
              type="button"
              class="w-10 h-10 inline-flex items-center justify-center rounded-md hover:bg-current/5"
              @click="closeMobile()"
              aria-label="Close menu"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M6 18L18 6" />
              </svg>
            </button>
          </div>

          <div class="flex-1 overflow-y-auto px-4 py-3 space-y-4">
            <a
              href="{{ routes.search_url }}"
              class="flex items-center gap-3 rounded-md border border-current/15 px-3 py-2 hover:bg-current/5 transition"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M11 18a7 7 0 100-14 7 7 0 000 14z" />
              </svg>
              <span class="text-sm">Search</span>
            </a>
            <nav class="space-y-2">
              {%- for link in menu.links -%}
                {% if link.links.size > 0 %}
                  {% assign has_children = true %}
                {% else %}
                  {% assign has_children = false %}
                {% endif %}
                <div x-data="{ open: false }" class="border border-current/15 rounded-md">
                  <button
                    type="button"
                    class="w-full flex items-center justify-between px-3 py-2 text-left text-sm font-medium hover:bg-current/5"
                    @click="open = !open"
                  >
                    <span>{{ link.title }}</span>
                    {%- if has_children -%}
                      <svg
                        class="w-4 h-4 transition"
                        :class="open ? 'rotate-180' : ''"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        viewBox="0 0 24 24"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6" />
                      </svg>
                    {%- endif -%}
                  </button>
                  <a
                    href="{{ link.url }}"
                    class="block px-3 pb-2 text-sm text-current/80 hover:text-current{% unless has_children %} pt-0{% endunless %}"
                  >
                    {{- link.title -}}
                  </a>
                  {%- if has_children -%}
                    <div
                      x-show="open"
                      x-transition:enter="transition ease-out duration-150"
                      x-transition:enter-start="opacity-0 -translate-y-1"
                      x-transition:enter-end="opacity-100 translate-y-0"
                      x-transition:leave="transition ease-in duration-100"
                      x-transition:leave-start="opacity-100 translate-y-0"
                      x-transition:leave-end="opacity-0 -translate-y-1"
                      class="border-t border-current/10"
                    >
                      <div class="flex flex-col py-2">
                        {%- for child in link.links -%}
                          <a href="{{ child.url }}" class="px-3 py-2 text-sm hover:bg-current/5">{{ child.title }}</a>
                        {%- endfor -%}
                      </div>
                    </div>
                  {%- endif -%}
                </div>
              {%- endfor -%}
            </nav>
          </div>

          <div class="px-4 py-3 border-t border-current/10 flex items-center justify-between">
            {%- if show_account -%}
              <a
                href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
                class="flex items-center gap-2 text-sm font-medium hover:opacity-80"
                rel="nofollow"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a5 5 0 100-10 5 5 0 000 10zM4 20.5c0-3.59 3.13-6.5 7-6.5s7 2.91 7 6.5" />
                </svg>
                <span>
                  {%- if customer -%}
                    {{- 'customer.account_fallback' | t -}}
                  {%- else -%}
                    {{- 'customer.log_in' | t -}}
                  {%- endif -%}
                </span>
              </a>
            {%- endif -%}
            <a href="{{ routes.cart_url }}" class="flex items-center gap-2 text-sm font-medium hover:opacity-80">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h2l1 14h12l1-10H6z" />
              </svg>
              <span>{{ 'templates.cart.cart' | t }}</span>
              {%- if cart != empty -%}
                <span class="ml-2 rounded-full bg-current text-[rgb(var(--color-background))] text-[10px] font-semibold px-2 py-0.5">
                  {{- cart.item_count -}}
                </span>
              {%- endif -%}
            </a>
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "max_blocks": 3,
  "settings": [
    { "type": "link_list", "id": "menu", "default": "main-menu", "label": "Main menu" },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "on-scroll-up", "label": "On scroll up" },
        { "value": "always", "label": "Always" }
      ],
      "default": "on-scroll-up",
      "label": "Sticky behavior"
    },
    { "type": "checkbox", "id": "show_line_separator", "default": true, "label": "Show bottom border" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "checkbox", "id": "enable_customer_avatar", "default": true, "label": "Show customer avatar" },
    {
      "type": "select",
      "id": "logo_icons_size",
      "label": "Logo size",
      "default": "size-5",
      "options": [
        {
          "value": "size-5",
          "label": "Small"
        },
        {
          "value": "size-6",
          "label": "Medium"
        },
        {
          "value": "size-10",
          "label": "Large"
        }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 16
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 16
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin bottom",
      "default": 0
    }
  ],
  "blocks": [{ "type": "@app" }],
  "presets": [{ "name": "Header" }]
}
{% endschema %}
