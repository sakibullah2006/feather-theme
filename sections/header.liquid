{%- liquid
  assign menu = linklists[section.settings.menu]
  if menu and menu.links.size > 0
    assign has_menu = true
  else
    assign has_menu = false
  endif

  assign show_account = shop.customer_accounts_enabled
  if section.settings.sticky_header_type != 'none'
    assign sticky_enabled = true
  else
    assign sticky_enabled = false
  endif
-%}

<section
  x-data="
    {
      mobileOpen: false,
      toggleMobile() {
        this.mobileOpen = !this.mobileOpen;
        if (this.mobileOpen) {
          const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
          document.body.style.overflow = 'hidden';
          document.body.style.paddingRight = scrollbarWidth + 'px';
        } else {
          document.body.style.overflow = '';
          document.body.style.paddingRight = '';
        }
      },
      closeMobile() {
        this.mobileOpen = false;
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
      }
    }
  "
  x-init="$el.style.setProperty('--header-height', $el.offsetHeight + 'px')"
  @keydown.window.escape="closeMobile()"
  @close-mobile.window="closeMobile()"
  class="{% if sticky_enabled %}shopify-section-header-sticky{% endif %} z-30 color-{{ section.settings.color_scheme }} gradient"
  data-sticky-type="{{ section.settings.sticky_header_type }}"
  style="background: rgb(var(--color-background)); color: rgb(var(--color-foreground)); margin-bottom: {{ section.settings.margin_bottom }}px; padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
>
  <div
    class="container-lg px-4 sm:px-6 lg:px-10 border-current/15 {% if section.settings.show_line_separator %}border-b{% endif %}"
    :inert="mobileOpen"
  >
    <div class="flex items-center justify-between h-16 gap-4">
      <div class="flex items-center gap-3 min-w-30">
        <a
          href="{{ routes.root_url }}"
          class="header__logo flex items-center gap-2 focus:outline-none {{ section.settings.logo_icons_size }}"
        >
          {%- if settings.logo != blank -%}
            {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
            {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 40vw, {{ settings.logo_width }}px{% endcapture %}
            {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
            {{
              settings.logo
              | image_url: width: 800
              | image_tag:
                class: 'header__logo-image',
                widths: widths,
                width: settings.logo_width,
                alt: logo_alt,
                sizes: sizes,
                preload: true
            }}
          {%- else -%}
            <span class="text-lg font-semibold tracking-tight">{{ shop.name }}</span>
          {%- endif -%}
        </a>
      </div>

      {%- if has_menu -%}
        <nav
          class="hidden lg:flex flex-1 items-center justify-center gap-6 text-sm font-medium"
          x-data="{ openId: null, setOpen(id) { this.openId = id }, clear() { this.openId = null } }"
          @mouseleave="clear()"
        >
          {%- for link in menu.links -%}
            {%- assign has_children = false -%}
            {%- assign has_mega_menu = false -%}
            {%- if link.links.size > 0 -%}
              {%- assign has_children = true -%}
              {%- comment %} Check if any child has grandchildren {%- endcomment %}
              {%- for child in link.links -%}
                {%- if child.links.size > 0 -%}
                  {%- assign has_mega_menu = true -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}

            <div
              {% if has_children %}
                x-data="{ open: false, timeout: null, openMenu() { clearTimeout(this.timeout); this.timeout = setTimeout(() => this.open = true, 100); }, closeMenu() { clearTimeout(this.timeout); this.timeout = setTimeout(() => this.open = false, 200); } }"
                @mouseleave="closeMenu()"
              {% endif %}
              class="relative"
            >
              <div @mouseenter="setOpen('{{ link.handle }}')">
                <a
                  href="{{ link.url }}"
                  :class="openId === '{{ link.handle }}' ? 'border-gray-900' : ''"
                  class="flex items-center gap-1 px-3 py-2 border-b-2 border-transparent hover:border-gray-900 transition-colors duration-200"
                >
                  <span class="text-[15px] font-medium">{{ link.title }}</span>
                </a>

                {%- if has_children -%}
                  {%- if has_mega_menu -%}
                    {%- comment %} MEGA MENU - Full Width {%- endcomment %}
                    {% render 'mega-menu',
                      link: link,
                      show_featured_content: section.settings.show_mega_menu_content,
                      content_type: section.settings.mega_menu_content_type,
                      featured_collection: section.settings.mega_menu_collection,
                      featured_products: section.settings.mega_menu_products,
                      open_id: link.handle
                    %}
                  {%- else -%}
                    {%- comment %} SIMPLE DROPDOWN {%- endcomment %}
                    {% render 'dropdown-menu', link: link, open_id: link.handle %}
                  {%- endif -%}
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        </nav>
      {%- else -%}
        <div class="flex-1" aria-hidden="true"></div>
      {%- endif -%}

      <div class="flex items-center justify-end gap-1 min-w-40">
        {% comment %} Search {% endcomment %}
        <div
          {% comment %} href="{{ routes.search_url }}" {% endcomment %}
          class="inline-flex items-center cursor-pointer lg:min-w-36 px-2 w-10 h-10 rounded-full lg:bg-current/5  hover:bg-current/10 transition"
          aria-label="Search"
        >
          {% render 'search-logo', class: 'size-6 justify-start' %}
          <input type="text" class="w-full focus:outline-0 ml-1 placeholder:font-medium" placeholder="Search">
        </div>

        {% comment %} Account Icon {% endcomment %}
        {%- if show_account -%}
          <div class="lg:hidden">
            <a
              href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
              class="inline-flex items-center justify-center w-10 h-10 rounded-full border-current/15 hover:bg-current/5 transition"
              aria-label="{%- if customer -%}Account{%- else -%}Sign In{%- endif -%}"
              rel="nofollow"
            >
              {% render 'account-logo', class: 'size-6' %}
            </a>
          </div>
        {%- endif -%}

        {% comment %} WishList Icon {% endcomment %}
        <a
          href="#"
          class="inline-flex items-center justify-center size-10 rounded-full  hover:bg-current/5 border-current/15  transition relative"
          aria-label="Cart"
          id="cart-icon-bubble"
        >
          {%- if cart == empty -%}
            {% render 'wishlist-logo', class: 'size-6' %}
          {%- else -%}
            {% render 'wishlist-logo', class: 'size-6' %}
          {%- endif -%}
        </a>

        {% comment %} Cart Icon {% endcomment %}
        <a
          href="{{ routes.cart_url }}"
          class="inline-flex items-center justify-center size-10 rounded-full  hover:bg-current/5 border-current/15  transition relative"
          aria-label="Cart"
          id="cart-icon-bubble"
        >
          {%- if cart == empty -%}
            {% render 'cart-logo', class: 'size-6' %}
          {%- else -%}
            {% render 'cart-logo', class: 'size-6' %}
          {%- endif -%}
          {%- if cart != empty -%}
            <span class="absolute -top-1 -right-1 min-w-4.5 h-4.5 rounded-full bg-current text-[rgb(var(--color-background))] text-[10px] font-semibold flex items-center justify-center px-1">
              {%- if cart.item_count < 100 -%}
                {{ cart.item_count }}
              {%- else -%}
                99+
              {%- endif -%}
            </span>
          {%- endif -%}
        </a>

        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when '@app' -%}
              {% render block %}
          {%- endcase -%}
        {%- endfor -%}

        <button
          type="button"
          class="lg:hidden inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-current/5 transition"
          @click="toggleMobile()"
          aria-label="Open menu"
        >
          <span class="sr-only">Toggle navigation</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  {%- if has_menu -%}
    {% render 'mobile-menu', menu: menu, show_account: show_account %}
  {%- endif -%}
</section>

{% stylesheet %}
{% endstylesheet %}

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "max_blocks": 3,
  "settings": [
    { "type": "link_list", "id": "menu", "default": "main-menu", "label": "Main menu" },
    {
      "type": "header",
      "content": "Mega menu featured content"
    },
    {
      "type": "checkbox",
      "id": "show_mega_menu_content",
      "label": "Show featured content in mega menu",
      "default": false,
      "info": "Display featured products or collection in mega menu dropdowns"
    },
    {
      "type": "select",
      "id": "mega_menu_content_type",
      "label": "Content type",
      "options": [
        { "value": "collection", "label": "Collection" },
        { "value": "products", "label": "Featured products" }
      ],
      "default": "collection"
    },
    {
      "type": "collection",
      "id": "mega_menu_collection",
      "label": "Featured collection",
      "info": "Shows collection image and info when content type is Collection"
    },
    {
      "type": "product_list",
      "id": "mega_menu_products",
      "label": "Featured products",
      "limit": 3,
      "info": "Choose up to 3 products to feature"
    },
    {
      "type": "header",
      "content": "Header settings"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "on-scroll-up", "label": "On scroll up" },
        { "value": "always", "label": "Always" }
      ],
      "default": "on-scroll-up",
      "label": "Sticky behavior"
    },
    { "type": "checkbox", "id": "show_line_separator", "default": false, "label": "Show bottom border" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "checkbox", "id": "enable_customer_avatar", "default": true, "label": "Show customer avatar" },
    {
      "type": "select",
      "id": "logo_icons_size",
      "label": "Logo size",
      "default": "size-10",
      "options": [
        {
          "value": "size-10",
          "label": "Small"
        },
        {
          "value": "size-14",
          "label": "Medium"
        },
        {
          "value": "size-16",
          "label": "Large"
        },
        {
          "value": "size-20",
          "label": "Extra Large"
        }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin bottom",
      "default": 0
    }
  ],
  "blocks": [{ "type": "@app" }],
  "presets": [{ "name": "Header" }]
}
{% endschema %}
