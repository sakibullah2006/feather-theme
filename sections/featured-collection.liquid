{%- liquid
  assign products_to_display = section.settings.collection.all_products_count

  if section.settings.collection.all_products_count > section.settings.products_to_show
    assign products_to_display = section.settings.products_to_show
  endif

  assign max_columns_mobile_int = section.settings.max_columns_mobile | plus: 0
  assign max_columns_desktop_int = section.settings.max_columns_desktop | plus: 0
-%}

{% style %}
  /* Carousel Styles */
  #ProductCarousel-{{ section.id }} {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  #ProductCarousel-{{ section.id }}::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  #ProductCarousel-{{ section.id }} > * {
    flex: 0 0 calc({{ 100 | divided_by: max_columns_mobile_int }}% - {{ 1 | times: max_columns_mobile_int | minus: 1 | divided_by: max_columns_mobile_int }}rem);
    scroll-snap-align: start;
  }

  @media screen and (min-width: 640px) {
    #ProductCarousel-{{ section.id }} > * {
      flex: 0 0 calc(33.333% - 0.667rem); /* Tablet: 3 columns */
    }
  }

  @media screen and (min-width: 920px) {
    #ProductCarousel-{{ section.id }} > * {
      flex: 0 0 calc({{ 100 | divided_by: max_columns_desktop_int }}% - {{ 1 | times: max_columns_desktop_int | minus: 1 | divided_by: max_columns_desktop_int }}rem);
    }
  }

  /* Grid Styles */
  #ProductGrid-{{ section.id }} {
    {% if section.settings.swipe_on_mobile %}
      /* Mobile: Carousel behavior when swipe_on_mobile is enabled */
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    {% else %}
      /* Mobile: Grid behavior */
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat({{ max_columns_mobile_int }}, 1fr);
    {% endif %}
  }

  {% if section.settings.swipe_on_mobile %}
    #ProductGrid-{{ section.id }}::-webkit-scrollbar {
      display: none;
    }

    #ProductGrid-{{ section.id }} > * {
      flex: 0 0 calc({{ 100 | divided_by: max_columns_mobile_int }}% - {{ 1 | times: max_columns_mobile_int | minus: 1 | divided_by: max_columns_mobile_int }}rem);
      scroll-snap-align: start;
    }
  {% endif %}

  @media screen and (min-width: 640px) {
    #ProductGrid-{{ section.id }} {
      /* Tablet: Always grid */
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(3, 1fr);
      overflow-x: visible;
      scroll-snap-type: none;
    }

    #ProductGrid-{{ section.id }} > * {
      flex: none;
    }
  }

  @media screen and (min-width: 920px) {
    #ProductGrid-{{ section.id }} {
      grid-template-columns: repeat({{ max_columns_desktop_int }}, 1fr);
    }
  }
{% endstyle %}

<section
  {% if section.settings.display_type == 'carousel' or section.settings.swipe_on_mobile %}
    x-data="carousel()"
  {% endif %}
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  class="container-lg space-y-4 px-5"
>
  {%- if section.settings.collection != blank and section.settings.collection.products_count > 0 -%}
    {% assign collection = section.settings.collection %}

    <div class="flex justify-between items-center">
      {% if section.settings.title != blank and section.settings.show_title %}
        <h2 class="tracking-tight text-black {{ section.settings.heading_size }} {{ section.settings.title_alignment }} ">
          {{ section.settings.title }}
        </h2>
      {% endif %}

      <div class="flex items-center gap-4">
        {%- if section.settings.show_view_all -%}
          {%- liquid
            case section.settings.view_all_style
              when 'link'
                assign view_all_classes = 'relative tracking-tight px-2 py-1 text-sm font-medium transition-all after:absolute after:bottom-0 after:left-0 after:h-[2px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full'
              when 'outline'
                assign view_all_classes = 'tracking-tight text-sm font-medium px-4 py-2 border border-current/20 hover:border-current/40 hover:bg-current/5 rounded-lg transition-all'
              when 'solid'
                assign view_all_classes = 'tracking-tight text-sm shadow-xs font-medium px-4 py-2 bg-current/10 hover:bg-current/20 rounded-lg transition-all'
            endcase
          -%}
          <a
            href="{{ collection.url }}"
            class="{{ view_all_classes }}"
            >View All</a
          >
        {%- endif -%}

        {%- comment -%} Navigation Buttons - Only show for carousel or grid with swipe on mobile {%- endcomment -%}

        {% if section.settings.display_type == 'carousel' %}
          {% assign show_navigation_buttons = true %}
        {% elsif section.settings.display_type == 'grid' and section.settings.swipe_on_mobile %}
          {% assign show_navigation_buttons = true %}
        {% else %}
          {% assign show_navigation_buttons = false %}
        {% endif %}

        {%- if show_navigation_buttons -%}
          <div class="flex gap-2 {% if section.settings.display_type != 'carousel' %}md:hidden{% endif %}">
            <button
              type="button"
              @click="prev()"
              :disabled="atStart"
              :class="{ 'opacity-40 cursor-not-allowed': atStart }"
              class="size-10 flex items-center justify-center hover:bg-current/7 bg-current/10 rounded-full transition-all disabled:hover:bg-current/10"
              aria-label="Previous"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button
              type="button"
              @click="next()"
              :disabled="atEnd"
              :class="{ 'opacity-40 cursor-not-allowed': atEnd }"
              class="size-10 flex items-center justify-center hover:bg-current/7 bg-current/10 rounded-full transition-all disabled:hover:bg-current/10"
              aria-label="Next"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        {%- endif -%}
      </div>
    </div>

    {%- if section.settings.display_type == 'carousel' -%}
      <!-- Product Carousel Container -->
      <div
        id="ProductCarousel-{{ section.id }}"
        x-ref="container"
        class="relative"
      >
        {%- for product in collection.products limit: products_to_display -%}
          {% render 'card-product',
            product: product,
            collection: collection,
            image_ratio: section.settings.image_ratio,
            card_image_position: section.settings.card_image_position,
            quick_view: section.settings.quick_view
          %}
        {%- endfor -%}
      </div>
    {%- else -%}
      <!-- Product Grid Container -->
      <div
        id="ProductGrid-{{ section.id }}"
        {% if section.settings.swipe_on_mobile %}
          x-ref="container"
        {% endif %}
        class="relative"
      >
        {%- for product in collection.products limit: products_to_display -%}
          {% render 'card-product',
            product: product,
            collection: collection,
            image_ratio: section.settings.image_ratio,
            card_image_position: section.settings.card_image_position,
            quick_view: section.settings.quick_view
          %}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {% comment %} End Collection Display {% endcomment %}
  {%- endif -%}
</section>

{% schema %}
{
  "name": "t:sections.featured-collection.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.featured-collection.settings.collection.label"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 25,
      "step": 1,
      "default": 4,
      "label": "t:sections.featured-collection.settings.products_to_show.label"
    },
    {
      "type": "header",
      "content": "t:sections.featured-collection.settings.header_text.content"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "t:sections.featured-collection.settings.title.default",
      "label": "t:sections.featured-collection.settings.title.label"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "default": true,
      "label": "Show Title"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {
          "value": "text-left",
          "label": "Left"
        },
        {
          "value": "text-center",
          "label": "Center"
        }
      ],
      "default": "text-left"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "text-lg",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "text-xl",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "text-2xl",
          "label": "t:sections.all.heading_size.options__3.label"
        },
        {
          "value": "text-3xl",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "text-5xl",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "text-2xl",
      "label": "t:sections.all.heading_size.label"
    },

    {
      "type": "header",
      "content": "t:sections.featured-collection.settings.header_collection.content"
    },
    {
      "type": "range",
      "id": "max_columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "Max Columns"
    },

    {
      "type": "select",
      "id": "display_type",
      "label": "Display type",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        }
      ],
      "default": "grid"
    },

    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": false,
      "label": "Carousel On Mobile"
    },

    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "t:sections.featured-collection.settings.show_view_all.label",
      "info": "t:sections.featured-collection.settings.show_view_all.info"
    },
    {
      "type": "select",
      "id": "view_all_style",
      "label": "t:sections.featured-collection.settings.view_all_style.label",
      "options": [
        {
          "value": "link",
          "label": "t:sections.featured-collection.settings.view_all_style.options__1.label"
        },
        {
          "value": "outline",
          "label": "t:sections.featured-collection.settings.view_all_style.options__2.label"
        },
        {
          "value": "solid",
          "label": "t:sections.featured-collection.settings.view_all_style.options__3.label"
        }
      ],
      "default": "solid"
    },

    {
      "type": "header",
      "content": "t:sections.featured-collection.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "max_columns_mobile",
      "default": "2",
      "label": "Max Colmns",
      "options": [
        {
          "value": "1",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.featured-collection.settings.columns_mobile.options__2.label"
        }
      ]
    },

    {
      "type": "header",
      "content": "t:sections.featured-collection.settings.header.content"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.featured-collection.settings.image_ratio.options__1.label"
        },
        {
          "value": "4/5",
          "label": "t:sections.featured-collection.settings.image_ratio.options__2.label"
        },
        {
          "value": "square",
          "label": "t:sections.featured-collection.settings.image_ratio.options__3.label"
        }
      ],
      "default": "adapt",
      "label": "t:sections.featured-collection.settings.image_ratio.label"
    },
    {
      "type": "select",
      "id": "card_image_position",
      "label": "Card Image Position",
      "options": [
        {
          "value": "object-top-left",
          "label": "Top Left"
        },
        {
          "value": "object-top",
          "label": "Top"
        },
        {
          "value": "object-top-right",
          "label": "Top Right"
        },
        {
          "value": "object-left",
          "label": "Left"
        },
        {
          "value": "object-center",
          "label": "Center"
        },
        {
          "value": "object-right",
          "label": "Right"
        },
        {
          "value": "object-bottom-left",
          "label": "Bottom Left"
        },
        {
          "value": "object-bottom",
          "label": "Bottom"
        },
        {
          "value": "object-bottom-right",
          "label": "Bottom Right"
        }
      ],
      "default": "object-top"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "t:sections.featured-collection.settings.show_secondary_image.label"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "t:sections.featured-collection.settings.show_vendor.label"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "t:sections.featured-collection.settings.show_rating.label",
      "info": "t:sections.featured-collection.settings.show_rating.info"
    },
    {
      "type": "checkbox",
      "id": "quick_view",
      "default": true,
      "label": "Quick View"
    },

    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured-collection.presets.name"
    }
  ]
}
{% endschema %}
