<div
  class="min-h-10 z-10 color-{{ section.settings.color_scheme }} gradient"
  style="background: rgb(var(--color-background)); color: rgb(var(--color-foreground));"
>
  <div class="max-w-5xl mx-auto w-full">
    <div class="flex items-center justify-center px-4 sm:px-6 lg:px-10 py-2 w-full">
      {%- if section.blocks.size > 0 -%}
        <div class="w-full text-center">
          {%- if section.blocks.size == 1 -%}
            <div class="relative w-full" {{ section.blocks.first.shopify_attributes }}>
              {%- assign block = section.blocks.first -%}
              {%- if block.settings.text != blank -%}
                {%- if block.settings.link != blank -%}
                  <a
                    href="{{ block.settings.link }}"
                    class="text-xs sm:text-sm font-medium hover:opacity-75 transition-opacity"
                  >
                    {{- block.settings.text -}}
                  </a>
                {%- else -%}
                  <span class="text-xs sm:text-sm font-medium">
                    {{- block.settings.text -}}
                  </span>
                {%- endif -%}
              {%- endif -%}
            </div>
          {%- else -%}
            <div
              x-cloak
              x-data="slider({ total: {{ section.blocks.size }}, autoplay: {{ section.settings.auto_rotate }}, speed: {{ section.settings.change_slides_speed }} * 1000 })"
              @mouseenter="stopAutoplay()"
              @mouseleave="if (autoplay) startAutoplay()"
              class="relative w-full"
            >
              <button
                x-ref="prevBtn"
                type="button"
                @click="prev()"
                class="hidden lg:flex absolute -left-10 top-1/2 -translate-y-1/2 z-10 size-10 items-center justify-center hover:bg-current/7 rounded-full transition-opacity"
                aria-label="Previous"
              >
                <svg
                  aria-hidden="true"
                  focusable="false"
                  viewBox="0 0 24 24"
                  role="img"
                  width="24px"
                  height="24px"
                  fill="none"
                >
                  <path stroke="currentColor" stroke-width="1.5" d="M15.525 18.966L8.558 12l6.967-6.967"></path>
                </svg>
              </button>

              <div x-ref="slides" class="min-h-10 flex items-center justify-center">
                <div class="relative w-full">
                  {%- for block in section.blocks -%}
                    <div
                      x-ref="slide_{{ forloop.index0 }}"
                      x-show="current === {{ forloop.index0 }}"
                      class="w-full transition-opacity duration-500"
                      :class="current === {{ forloop.index0 }} ? 'opacity-100' : 'opacity-0'"
                      {{ block.shopify_attributes }}
                    >
                      {%- if block.settings.text != blank -%}
                        {%- if block.settings.link != blank -%}
                          <a
                            href="{{ block.settings.link }}"
                            class="text-xs sm:text-sm font-medium hover:opacity-75 transition-opacity"
                          >
                            {{- block.settings.text -}}
                          </a>
                        {%- else -%}
                          <span class="text-xs sm:text-sm font-medium">
                            {{- block.settings.text -}}
                          </span>
                        {%- endif -%}
                      {%- endif -%}
                    </div>
                  {%- endfor -%}
                </div>
              </div>

              <button
                x-ref="nextBtn"
                type="button"
                @click="next()"
                class="hidden lg:flex absolute -right-10 top-1/2 -translate-y-1/2 z-10 size-10 items-center justify-center  hover:bg-current/7 rounded-full transition-opacity"
                aria-label="Next"
              >
                <svg
                  aria-hidden="true"
                  focusable="false"
                  viewBox="0 0 24 24"
                  role="img"
                  width="24px"
                  height="24px"
                  fill="none"
                >
                  <path stroke="currentColor" stroke-width="1.5" d="M8.474 18.966L15.44 12 8.474 5.033"></path>
                </svg>
              </button>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Announcement Bar",
  "max_blocks": 12,
  "class": "announcement-bar-section",
  "enabled_on": { "groups": ["header"] },
  "settings": [
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate announcements",
      "default": true   
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-2"
    },
    {
      "type": "checkbox",
      "id": "show_line_separator",
      "default": true,
      "label": "Show bottom border"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "text",
          "default": "Welcome to our store",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Bar",
      "blocks": []
    }
  ]
}
{% endschema %}
