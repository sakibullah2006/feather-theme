{% comment %}
  Renders gift card recipient form.
  Accepts:
  - product: {Object} product object.
  - form: {Object} the product form object.
  - section: {Object} section to which this snippet belongs.

  Usage:
  {% render 'gift-card-recipient-form', product: product, form: form, section: section %}
{% endcomment %}

<div class="block w-full mt-4">
  {%- assign gift_card_recipient_control_flag = 'properties[__shopify_send_gift_card_to_recipient]' -%}
  <script src="{{ 'recipient-form.js' | asset_url }}" defer="defer"></script>
  <recipient-form
    class="block w-full"
    data-section-id="{{ section.id }}"
    data-product-variant-id="{{ product.selected_or_first_available_variant.id }}"
  >
    <div class="flex items-center gap-2 mb-4">
      <input
        id="Recipient-checkbox-{{ section.id }}"
        type="checkbox"
        name="{{ gift_card_recipient_control_flag }}"
        disabled
        class="h-4 w-4 rounded border-gray-300 text-black focus:ring-black"
      >
      <label class="text-sm text-gray-900 font-medium cursor-pointer" for="Recipient-checkbox-{{ section.id }}">
        <span>{{ 'recipient.form.checkbox' | t }}</span>
      </label>
    </div>

    <div
      class="mb-4 hidden"
      role="alert"
      {% unless form.errors %}
        hidden
      {% endunless %}
    >
      <h2 class="text-red-800 text-sm font-bold flex items-center gap-2 mb-2" tabindex="-1" autofocus>
        <span class="w-4 h-4 text-red-600">{{ 'icon-error.svg' | inline_asset_content }}</span>
        <span class="error-message">{{ 'templates.contact.form.error_heading' | t }}</span>
      </h2>

      <ul class="list-disc pl-5 text-sm text-red-600 space-y-1">
        {%- if form.errors -%}
          {%- for field in form.errors -%}
            <li>
              {%- if field == 'form' -%}
                {{ form.errors.messages[field] }}
              {%- else -%}
                <a href="#Recipient-{{ field }}-{{ section.id }}" class="underline hover:no-underline">
                  {{ form.errors.messages[field] }}
                </a>
              {%- endif -%}
            </li>
          {%- endfor -%}
        {%- endif -%}
      </ul>
    </div>
    <p
      id="Recipient-fields-live-region-{{ section.id }}"
      class="sr-only"
      role="status"
    ></p>
    <div class="recipient-fields space-y-4">
      <hr class="border-gray-200">

      <!-- Email -->
      <div>
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Recipient-email-{{ section.id }}">
            <span class="after:content-['*'] after:ml-0.5 after:text-red-500">
              {{- 'recipient.form.email_label' | t -}}
            </span>
            <span class="sr-only">
              {{- 'recipient.form.email_label_optional_for_no_js_behavior' | t -}}
            </span>
          </label>
          <input
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm py-2.5 px-3"
            id="Recipient-email-{{ section.id }}"
            type="email"
            placeholder="{{ 'recipient.form.email' | t }}"
            name="properties[Recipient email]"
            value="{{ form.email }}"
            {% if form.errors contains 'email' %}
              aria-invalid="true"
              aria-describedby="RecipientForm-email-error-{{ section.id }}"
            {% endif %}
          >
        </div>

        <div
          id="RecipientForm-email-error-{{ section.id }}"
          class="mt-1 text-sm text-red-600 flex items-center gap-1 {% unless form.errors contains 'email' %} hidden{% endunless %}"
        >
          <span class="w-4 h-4">{{ 'icon-error.svg' | inline_asset_content }}</span>
          <span class="error-message">
            {%- if form.errors contains 'email' -%}
              {{ form.errors.messages.email }}.
            {%- endif -%}
          </span>
        </div>
      </div>

      <!-- Name -->
      <div>
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Recipient-name-{{ section.id }}">
            {{- 'recipient.form.name_label' | t -}}
          </label>
          <input
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm py-2.5 px-3"
            autocomplete="name"
            type="text"
            id="Recipient-name-{{ section.id }}"
            name="properties[Recipient name]"
            placeholder="{{ 'recipient.form.name' | t }}"
            value="{{ form.name }}"
            {% if form.errors contains 'name' %}
              aria-invalid="true"
              aria-describedby="RecipientForm-name-error-{{ section.id }}"
            {% endif %}
          >
        </div>

        <div
          id="RecipientForm-name-error-{{ section.id }}"
          class="mt-1 text-sm text-red-600 flex items-center gap-1 {% unless form.errors contains 'name' %} hidden{% endunless %}"
        >
          <span class="w-4 h-4">{{ 'icon-error.svg' | inline_asset_content }}</span>
          <span class="error-message">
            {%- if form.errors contains 'name' -%}
              {{ form.errors.messages.name }}.
            {%- endif -%}
          </span>
        </div>
      </div>

      <!-- Message -->
      <div>
        {%- assign max_chars_message = 200 -%}
        {%- assign max_chars_message_rendered = 'recipient.form.max_characters' | t: max_chars: max_chars_message -%}
        {%- assign message_label_rendered = 'recipient.form.message_label' | t -%}
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Recipient-message-{{ section.id }}">
            {{ message_label_rendered }}
          </label>
          <textarea
            rows="5"
            id="Recipient-message-{{ section.id }}"
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm py-2.5 px-3"
            name="properties[Message]"
            maxlength="{{ max_chars_message }}"
            placeholder="{{ 'recipient.form.message' | t }}"
            aria-label="{{ message_label_rendered }} {{ max_chars_message_rendered }}"
            {% if form.errors contains 'message' %}
              aria-invalid="true"
              aria-describedby="RecipientForm-message-error-{{ section.id }}"
            {% endif %}
          >{{ form.message }}</textarea>
        </div>

        <label class="block text-xs text-gray-500 mt-1 text-right">
          <span>{{ max_chars_message_rendered }}</span>
        </label>

        <div
          id="RecipientForm-message-error-{{ section.id }}"
          class="mt-1 text-sm text-red-600 flex items-center gap-1 {% unless form.errors contains 'message' %} hidden{% endunless %}"
        >
          <span class="w-4 h-4">{{ 'icon-error.svg' | inline_asset_content }}</span>
          <span class="error-message">
            {%- if form.errors contains 'message' -%}
              {{ form.errors.messages.message }}.
            {%- endif -%}
          </span>
        </div>
      </div>

      <!-- Date -->
      <div>
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Recipient-send-on-{{ section.id }}">
            {{ 'recipient.form.send_on_label' | t }}
          </label>
          <input
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm py-2.5 px-3 placeholder-gray-400"
            autocomplete="send_on"
            type="date"
            id="Recipient-send-on-{{ section.id }}"
            name="properties[Send on]"
            placeholder="{{ 'recipient.form.send_on' | t }}"
            pattern="\d{4}-\d{2}-\d{2}"
            value="{{ form.send_on }}"
            {% if form.errors contains 'send_on' %}
              aria-invalid="true"
              aria-describedby="RecipientForm-send_on-error-{{ section.id }}"
            {% endif %}
          >
        </div>

        <div
          id="RecipientForm-send_on-error-{{ section.id }}"
          class="mt-1 text-sm text-red-600 flex items-center gap-1 {% unless form.errors contains 'send_on' %} hidden{% endunless %}"
        >
          <span class="w-4 h-4">{{ 'icon-error.svg' | inline_asset_content }}</span>
          <span class="error-message">
            {%- if form.errors contains 'send_on' -%}
              {{ form.errors.messages.send_on }}.
            {%- endif -%}
          </span>
        </div>
      </div>
    </div>
    <input
      type="hidden"
      name="{{ gift_card_recipient_control_flag }}"
      value="if_present"
      id="Recipient-control-{{ section.id }}"
    >
    <input
      type="hidden"
      name="properties[__shopify_offset]"
      value=""
      id="Recipient-timezone-offset-{{ section.id }}"
      disabled
    >
  </recipient-form>
</div>
