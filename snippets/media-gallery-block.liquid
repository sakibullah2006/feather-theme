<div class="media-gallery" x-data="mediaGallery()">
  <!-- Main Image Display -->
  <div class="media-gallery__main mb-4">
    <div class="relative aspect-square overflow-hidden rounded-lg bg-gray-100">
      {% if product.media.size > 0 %}
        <template x-for="(media, index) in {{ product.media | json }}" :key="index">
          <img
            :src="media.src"
            :alt="media.alt || '{{ product.title }}'"
            class="w-full h-full object-cover transition-opacity duration-300"
            x-show="currentIndex === index"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            width="800"
            height="800"
          >
        </template>
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
      {% endif %}
    </div>
  </div>

  <!-- Thumbnail Grid -->
  {% if product.media.size > 1 %}
    <div class="media-gallery__thumbnails">
      <div class="grid grid-cols-4 gap-2">
        {% for media in product.media limit: 8 %}
          <button
            type="button"
            class="media-gallery__thumbnail aspect-square overflow-hidden rounded-md border-2 transition-all"
            :class="currentIndex === {{ forloop.index0 }} ? 'border-black' : 'border-gray-200 hover:border-gray-400'"
            @click="currentIndex = {{ forloop.index0 }}"
          >
            {% if media.media_type == 'image' %}
              {{ media | image_url: width: 200 | image_tag: class: 'w-full h-full object-cover', alt: media.alt }}
            {% elsif media.media_type == 'video' or media.media_type == 'external_video' %}
              <div class="relative w-full h-full">
                {{
                  media.preview_image
                  | image_url: width: 200
                  | image_tag: class: 'w-full h-full object-cover', alt: media.alt
                }}
                <div class="absolute inset-0 flex items-center justify-center">
                  <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                  </svg>
                </div>
              </div>
            {% endif %}
          </button>
        {% endfor %}
      </div>
    </div>
  {% endif %}
</div>

<script>
  function mediaGallery() {
    return {
      currentIndex: 0,
    };
  }
</script>
