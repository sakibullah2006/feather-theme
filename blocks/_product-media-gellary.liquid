<style>
  .media-gallery-container {
    display: flex;
    flex-direction: column-reverse;
    gap: 20px;
  }

  .media-gallery__thumbnails {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
  }

  .media-gallery__thumbnails::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  .thumbnail-list {
    display: flex;
    gap: 10px;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .media-gallery__viewer {
    flex: 1;
    width: 100%;
  }

  .media-gallery__thumbnails .thumbnail-list__item {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
  }

  .thumbnail-button {
    width: 100%;
    height: 100%;
    padding: 0;
    border: 2px solid transparent;
    background: none;
    cursor: pointer;
    overflow: hidden;
    border-radius: 4px;
    display: block;
    position: relative;
  }

  .thumbnail-button[aria-current='true'] {
    border-color: black;
  }

  .thumbnail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .product__media-list {
    display: block; /* Stacked by default, but we hide inactive */
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .product__media-item {
    display: none;
    width: 100%;
  }

  .product__media-item.is-active {
    display: block;
  }

  .product__media-item video,
  .product__media-item img,
  .product__media-item iframe,
  .product__media-item model-viewer {
    width: 100%;
    height: auto;
    display: block;
    aspect-ratio: 1 / 1; /* Or generic aspect ratio */
    object-fit: cover;
    border-radius: 8px; /* Optional rounded corners */
  }

  /* Desktop Styles */
  @media (min-width: 768px) {
    .media-gallery-container {
      flex-direction: row;
      align-items: flex-start;
    }

    .media-gallery__thumbnails {
      flex-direction: column;
      width: 80px;
      height: 500px; /* Limit height to allow scrolling if many images */
      overflow-y: auto;
      overflow-x: hidden;
    }

    .thumbnail-list {
      flex-direction: column;
    }

    .media-gallery__thumbnails .thumbnail-list__item {
      width: 100%;
      height: 80px;
    }
  }
</style>

<media-gallery
  id="MediaGallery-{{ section.id }}"
  role="region"
  class="media-gallery-container"
  aria-label="{{ 'products.product.media.gallery_viewer' | t }}"
  data-desktop-layout="thumbnail_left"
>
  <div id="GalleryStatus-{{ section.id }}" class="visually-hidden" role="status"></div>

  <!-- Thumbnails (Left on Desktop, Bottom on Mobile) -->
  <div class="media-gallery__thumbnails">
    <slider-component id="GalleryThumbnails-{{ section.id }}" class="thumbnail-slider">
      <ul
        class="thumbnail-list"
        role="list"
      >
        {%- for media in closest.product.media -%}
          <li
            id="Slide-Thumbnails-{{ section.id }}-{{ forloop.index }}"
            class="thumbnail-list__item slider__slide{% if media.id == closest.product.selected_or_first_available_variant.featured_media.id %} is-active{% endif %}"
            data-target="{{ media.id }}"
            data-media-position="{{ media.position }}"
          >
            <button
              class="thumbnail-button"
              aria-label="{{ 'products.product.media.load_image' | t: index: forloop.index }}"
              {% if media.id == closest.product.selected_or_first_available_variant.featured_media.id %}
                aria-current="true"
              {% endif %}
              aria-controls="GalleryViewer-{{ section.id }}"
              aria-describedby="Thumbnail-{{ section.id }}-{{ forloop.index }}"
            >
              <img
                id="Thumbnail-{{ section.id }}-{{ forloop.index }}"
                src="{{ media | image_url: width: 100, height: 100, crop: 'center' }}"
                alt="{{ media.alt | escape }}"
                loading="lazy"
                class="thumbnail-image"
                width="100"
                height="100"
              >
            </button>
          </li>
        {%- endfor -%}
      </ul>
    </slider-component>
  </div>

  <!-- Main Viewer (Right on Desktop) -->
  <div id="GalleryViewer-{{ section.id }}" class="media-gallery__viewer">
    <ul
      class="product__media-list"
      role="list"
    >
      {%- for media in closest.product.media -%}
        <li
          id="Slide-{{ section.id }}-{{ media.id }}"
          class="product__media-item{% if media.id == closest.product.selected_or_first_available_variant.featured_media.id %} is-active{% endif %}"
          data-media-id="{{ media.id }}"
        >
          {% render 'product-media', media: media, loop: section.settings.enable_video_looping, variant_image: false %}
        </li>
      {%- endfor -%}
    </ul>
  </div>
</media-gallery>

<script src="{{ 'media-gallery.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Product Media Gallery",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "Enable video looping",
      "default": true
    }
  ]
}
{% endschema %}
